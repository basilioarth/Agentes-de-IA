# Resumo da Aula ‚Äì Orquestra√ß√£o das Chamadas de Fun√ß√£o

## Mudan√ßas na estrutura das ferramentas
- Renomeado tudo para **definitions** (mais preciso)  
- Cada ferramenta agora √© um objeto com:  
  - `declaration`: configura√ß√£o enviada ao Gemini  
  - `function`: implementa√ß√£o real execut√°vel  
- Criadas duas vari√°veis principais:  
  - `allDefinitions`: array com todas as 6 ferramentas (calendar + email)  
  - `allDeclarations`: extra√≠do via `.map(def => def.declaration)` ‚Üí enviado ao Gemini em `functionDeclarations`  
  - `allFunctions`: mapa (objeto) com `name ‚Üí fun√ß√£o execut√°vel` via `Object.fromEntries(...)`  
    ‚Üí Permite chamar dinamicamente qualquer fun√ß√£o pelo nome

## Orquestra√ß√£o b√°sica implementada
Fluxo completo para uma √∫nica chamada de fun√ß√£o:

1. Usu√°rio faz pergunta (ex.: "Quais eventos eu tenho em 2025-05-01?")  
2. Gemini responde com `functionCall` contendo:  
   - `name`: nome da fun√ß√£o  
   - `args`: par√¢metros  
3. C√≥digo extrai:  
   - `functionName = functionCall.name`  
   - `functionArgs = functionCall.args`  
4. Busca a fun√ß√£o real: `const fn = allFunctions[functionName]`  
5. Executa: `const result = fn(functionArgs)`  
6. Devolve resultado ao Gemini via mensagem especial:  
   ```js
   {
     role: "user",
     parts: [
       {
         functionResponse: {
           name: functionName,
           response: { result }
         }
       }
     ]
   }
   ```
7. Gemini recebe o resultado e responde ao usu√°rio de forma natural  
   Exemplo: lista os eventos do dia com t√≠tulos e hor√°rios

## Testes realizados com sucesso
- "Que dia √© hoje?" ‚Üí chamou `getTodayDate` ‚Üí respondeu "Hoje √© quinta-feira, 1¬∫ de maio de 2025"  
- "Quais eventos em 2025-05-01?" ‚Üí chamou `getEvents` ‚Üí listou "Almo√ßo de feriado" e "Churrasco em fam√≠lia" com hor√°rios  
- A IA est√° usando corretamente as fun√ß√µes declaradas e recebendo os resultados mockados

## Problemas identificados e pr√≥ximos passos
1. **Input hardcodado**  
   - Atualmente a pergunta √© fixa no c√≥digo  
   - Precisa virar um chat interativo no terminal

2. **Apenas uma chamada de fun√ß√£o por vez**  
   - Perguntas simples funcionam  
   - Perguntas complexas (ex.: "Quais eventos eu tenho amanh√£?") exigem **m√∫ltiplas chamadas seguidas**:  
     1. Chamar `getTodayDate`  
     2. Calcular amanh√£  
     3. Chamar `getEvents` com a data de amanh√£  

   ‚Üí Necessita de um **loop** que continue enquanto o Gemini retornar `functionCall`

## Roadmap para a pr√≥xima etapa
1. **Adicionar loop de orquestra√ß√£o**  
   - Enquanto a resposta contiver `functionCall` ‚Üí executar fun√ß√£o ‚Üí enviar `functionResponse` ‚Üí chamar Gemini novamente  
   - Parar apenas quando a resposta for texto final (sem function call)

2. **Transformar em chat interativo**  
   - Ler input do usu√°rio via `process.stdin` / `readline`  
   - Manter hist√≥rico da conversa  
   - Permitir m√∫ltiplas perguntas em sequ√™ncia como um chat real

A secret√°ria est√° quase viva!  
Falta s√≥ o loop de m√∫ltiplas ferramentas e a interface de chat para podermos conversar naturalmente com ela (incluindo perguntas que exigem racioc√≠nio em cadeia, como "amanh√£", "pr√≥xima semana" etc.).  

Pr√≥xima aula: loop de orquestra√ß√£o + chat no terminal! üöÄ