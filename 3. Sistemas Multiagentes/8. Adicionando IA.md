## Tornando o Supervisor inteligente com IA (Google Gemini via LangChain)

### Objetivo da aula

Nesta etapa, o foco é **substituir a lógica hardcoded do Supervisor por decisões tomadas por uma IA**. O Supervisor passa a escolher dinamicamente **qual nó executar em seguida**, usando o modelo **Google Gemini**, integrado via **LangChain**, e não mais pela SDK direta do Google.

---

### Integração com o Google Gemini via LangChain

* Instalação da biblioteca:

  * `langchain-google-genai`.
* Importação e uso do `ChatGoogleGenerativeAI`.
* Criação de uma instância do modelo:

  * Uso inicial do modelo **Flash**.
  * Possibilidade de trocar para o **Pro**, caso necessário.
* A chave da API é lida de uma variável de ambiente.
* Teste inicial com `invoke("Olá")` confirma que:

  * A IA responde corretamente.
  * A integração está funcionando.

---

### Mudança de papel da IA

* A IA deixa de ser apenas um chatbot.
* Passa a atuar como **agente decisor (Supervisor)**.
* A função do Supervisor agora é:

  * Analisar o contexto.
  * Escolher **qual especialista ou estado será executado a seguir**.

---

### Evolução do estado: NextNode

* O estado do grafo é expandido com um novo campo:

  * `nextNode`.
* Esse campo representa:

  * O **próximo nó** que o grafo deve executar.
* O Supervisor passa a:

  * Atualizar o `nextNode` com base na decisão tomada.
* As **arestas condicionais** agora:

  * Retornam `state.nextNode`, em vez de lógica fixa.

---

### Manutenção do fluxo existente

* Antes de usar IA de fato:

  * A lógica anterior é replicada usando `nextNode`.
* Isso garante que:

  * O grafo continua funcionando como antes.
  * A mudança de arquitetura não quebre o fluxo existente.

---

### Primeira decisão baseada em IA

* O Supervisor chama a IA com um prompt do tipo:

  * “Escolha um dos próximos estados”.
* As opções fornecidas são:

  * Financial Specialist.
  * Scheduling Specialist.
  * Comms Specialist.
  * End.
* A resposta da IA é registrada no console para inspeção.

---

### Problema de formatação da resposta

* A IA responde em linguagem natural:

  * Inclui frases como “Eu escolho…” ou quebras de linha.
* Isso gera problemas, pois:

  * O grafo espera **exatamente o nome do nó**.
  * Qualquer variação quebra a navegação condicional.

---

### Tentativas de correção

* O prompt é ajustado para:

  * Pedir explicitamente que a IA retorne **apenas o nome do nó**.
* A resposta passa a ser lida a partir de:

  * `AIMessage.content`.
* Ainda assim:

  * Pequenas variações (como `\n`) causam falhas.
* Isso evidencia que:

  * Apenas confiar em prompt não é suficiente.

---

### Conclusão parcial

* A IA **já está tomando decisões reais**.
* O Supervisor agora delega o controle do fluxo à IA.
* Porém, o sistema ainda é frágil:

  * Depende de respostas textuais não estruturadas.
  * Pequenas variações de saída quebram o grafo.

---

### Próximo passo anunciado

* Resolver o problema de forma definitiva usando:

  * **Ferramentas (tools)**.
* A ideia é:

  * Restringir as opções da IA.
  * Garantir que ela retorne **somente valores válidos e esperados**.
* No próximo vídeo:

  * Será criada uma ferramenta que força a IA a escolher apenas entre os nós permitidos.
