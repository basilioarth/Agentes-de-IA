## Transformando os especialistas em agentes **ReAct (Reasoning + Acting)**

### Objetivo do vídeo

Nesta etapa, o foco é **transformar os especialistas em agentes inteligentes**, assim como o Supervisor.
Até agora:

* O **Supervisor já é um agente** (analisa mensagens e decide para onde ir).
* Os **especialistas ainda eram passivos**, apenas retornando mensagens fixas.

A ideia agora é fazer com que cada especialista:

* **Analise a conversa (Reasoning)**
* **Execute ações usando ferramentas (Acting)**

---

## Conceito-chave: Agente ReAct

* **ReAct = Reasoning + Acting**
* O agente:

  * Lê o histórico da conversa.
  * Decide o que fazer.
  * Executa uma ferramenta, se necessário.
* O LangGraph fornece um helper pronto para isso:

  * `createReactAgent`

---

## Criando o agente do Financial Specialist

### Uso do `createReactAgent`

O `FinancialSpecialistAgent` é criado com três parâmetros principais:

1. **LLM**

   * A mesma IA já configurada (Gemini via LangChain).

2. **Ferramentas (tools)**

   * Lista de ações que o agente pode executar.
   * Inicialmente vazia, mas será preenchida depois.

3. **Prompt do sistema**

   * Define o papel do agente.
   * Exemplo:

     * “Você é um analista financeiro de um consultório.”
     * “Analise a conversa e tome a melhor ação para atender o usuário.”

Esse prompt é passado como um **`SystemMessage`**.

---

## Executando o agente dentro do nó

Dentro do `Financial Specialist`:

1. O agente é chamado com:

   * `agent.invoke(state)`
2. O `state` contém:

   * O histórico completo em `messages`.
3. O agente:

   * Acrescenta seu raciocínio.
   * Pode chamar ferramentas.
4. O resultado:

   * Retorna **todas as mensagens geradas pelo agente**.

---

## Capturando a resposta do agente

* O resultado da execução:

  * Contém uma lista de mensagens.
* A resposta final do especialista:

  * É a **última mensagem** (`messages[messages.length - 1]`).
* Essa mensagem é então:

  * Reempacotada como `HumanMessage`.
  * Representa o “especialista falando com o usuário”.

> Importante:
> Usar `HumanMessage` evita confusão no Supervisor, que precisa entender que **alguém falou com o usuário**, e não a IA consigo mesma.

---

## Criando ferramentas para o especialista

### Dynamic Structured Tool

Para declarar ferramentas, é usado:

* `DynamicStructuredTool`

Ela permite definir:

* Nome da ferramenta.
* Descrição.
* Esquema de entrada (Zod).
* Função que executa a ação.

---

### Exemplo: ferramenta `payBill`

Ferramenta criada para o Financial Specialist:

* **Nome:** `payBill`
* **Descrição:** pagar a conta do usuário.
* **Schema (Zod):**

  * Recebe, por exemplo, o valor da conta (`price`).
* **Função:**

  * Simulada (mock).
  * Exibe log: “Pagando conta”.
  * Retorna: “Conta paga com sucesso”.

Essa ferramenta é adicionada à lista de tools do agente.

---

## Fluxo completo com agente financeiro

1. Usuário diz:

   * “Quero pagar minha conta de 300 reais”.
2. Supervisor:

   * Analisa a mensagem.
   * Decide chamar o **Financial Specialist**.
3. Financial Specialist:

   * Analisa o histórico.
   * Decide que precisa pagar a conta.
   * Chama a ferramenta `payBill`.
4. Ferramenta:

   * Executa a ação simulada.
5. Especialista:

   * Retorna mensagem: “Sua conta foi paga com sucesso”.
6. Supervisor:

   * Recebe essa nova mensagem.
   * Decide encerrar o fluxo (`End`).

---

## Problemas encontrados (e soluções)

### 1. Schema vazio não funciona

* O `DynamicStructuredTool` **exige um schema válido**.
* Solução:

  * Criar um schema simples com `z.object(...)`, mesmo que seja mínimo.

### 2. Erro “Unsupported Author”

* Causa:

  * Passar `name` indevido na mensagem.
* Solução:

  * Remover o `name` para evitar conflito no parsing da IA.

---

## Resultado final

* O **Financial Specialist agora é um agente ReAct**:

  * Analisa contexto.
  * Executa ações.
  * Responde com base no resultado.
* O sistema começa a se comportar como:

  * Um **multiagente real**, não apenas um fluxo fixo.

---

## Próximos passos anunciados

* Ajustar:

  * Criação de ferramentas **sem parâmetros**.
* Criar agentes para:

  * **Scheduling Specialist**
  * **Comms Specialist**
* Finalizar o fluxo:

  * Integração com interação direta com o usuário (chat).
  * Retornar respostas de forma mais limpa para o humano.

---
